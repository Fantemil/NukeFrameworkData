import os
import time
import platform
import getpass
import requests
import colorama
#  making a clear command
def clr():
    if os.name == 'nt':
        os.system('cls')
    else:
        os.system('clear')

#defining a welcome message
def welcome():
    print("==========================================================")
    print("Welcome to Nukehook (Webhook spam tool)")
    print("==========================================================")
    print("")
    print("Spam a webhook (1)")
clr()
def getlocaluser():
    try:
        global User
        User = getpass.getuser()
    except:
        User = "(Could not get local user)"
    return User
def macexitrun():
    os.chdir("..")
    print("Returning to NukeFramework...")
    time.sleep(1)
    clr()
    os.chdir("/Users/" + getlocaluser() + "/Library/Application Support/NF2/Data")
    with open("runnerlocation.txt", "r") as f:
        runnerlocation = f.read()
    os.system("python3 " + runnerlocation)
    exit()
method = None

hostos = platform.system()
if hostos == "Darwin":
    welcome()
    
    method = input("Enter the method you want to use (type exit if you want to return to nf2): ")
    # trim method
    method = method.strip()
    if method == "exit":
        macexitrun()
    if method == "1":
        webhook = input("Enter the webhook you want to spam: ")
        webhook = webhook.strip()
        message = input("Enter the message you want to spam: ")
        message = message.strip()
        # optional amount of messages. user should type 0 if they want to spam forever 
        amount = input("Enter the amount of messages you want to send (type 0 if you want to spam forever): ")
        amount = amount.strip()
        if amount == "0":
            while True:
                # also get the response from the webhook
                response = requests.post(webhook, data={"content": message})
                response = str(response)
                if response == "<Response [204]>":
                    # with colorama
                    print(colorama.Fore.GREEN + "Message sent successfully!")
                else:
                    print(colorama.Fore.RED + "Message failed to send!")
                    print(colorama.Fore.RED + "Response: " + response)
        else:
            for i in range(int(amount)):
                response = requests.post(webhook, data={"content": message})
                # translate the response to a string
                response = str(response)
                if response == "<Response [204]>":
                    # with colorama
                    print(colorama.Fore.GREEN + "Message sent successfully!")
                else:
                    print(colorama.Fore.RED + "Message failed to send!")
                    print(colorama.Fore.RED + "Response: " + response)
    else:
        print("Invalid method!")
        time.sleep(1)

else:
    clr()
    # not supported yet
    print("This tool is not supported on your OS yet.")
    exit()