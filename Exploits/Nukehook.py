import os
import time
import platform
import getpass
import requests
import colorama
import random
#  making a clear command
def clr():
    if os.name == 'nt':
        os.system('cls')
    else:
        os.system('clear')

#defining a welcome message
def welcome():
    print("==========================================================")
    print("Welcome to Nukehook (Webhook spam tool)")
    print("==========================================================")
    print("")
    print("Spam a webhook (1)")
clr()
def getlocaluser():
    try:
        global User
        User = getpass.getuser()
    except:
        User = "(Could not get local user)"
    return User
def macexitrun():
    os.chdir("..")
    print("Returning to NukeFramework...")
    time.sleep(1)
    clr()
    os.chdir("/Users/" + getlocaluser() + "/Library/Application Support/NF2/Data")
    with open("runnerlocation.txt", "r") as f:
        runnerlocation = f.read()
    os.system("python3 " + runnerlocation + "/run.py")
    exit()
method = None
counter = 0
hostos = platform.system()
# get proxies from NF2 data



if hostos == "Darwin":
    

    welcome()
    
    method = input("Enter the method you want to use (type exit if you want to return to nf2): ")
    # trim method
    method = method.strip()
    if method == "exit":
        macexitrun()
    if method == "1":
        webhook = input("Enter the webhook you want to spam: ")
        webhook = webhook.strip()
        message = input("Enter the message you want to spam: ")
        message = message.strip()
        # optional amount of messages. user should type 0 if they want to spam forever 
        amount = input("Enter the amount of messages you want to send (type 0 if you want to spam forever): ")
        amount = amount.strip()
        negateamount = amount
        if amount == "0":
            while True:
                
                # print in green the current proxy
                for i in range(30):
                    # also get the response from the webhook
                    time.sleep(random.uniform(0.3, 0.5))
                    response = requests.post(webhook, data={"content": message})
                    response = str(response)
                    if response == "<Response [204]>":
                        # with colorama
                        counter += 1
                        print(colorama.Fore.GREEN + "Message sent successfully! This is message number " + str(counter) + "!")
                    elif response == "<Response [404]>":
                        # print in yellow that the webhook is invalid
                        print(colorama.Fore.YELLOW + "Webhook is invalid!")
                        time.sleep(1)
                        os.chdir("/Users/" + getlocaluser() + "/Library/Application Support/NF2/Data")
                        with open("runnerlocation.txt", "r") as f:
                            runnerlocation = f.read()
                        os.system("python3 " + runnerlocation + "/run.py")
                        exit()
                    else:
                        print(colorama.Fore.RED + "Message failed to send!")
                        print(colorama.Fore.RED + "Response: " + response)
                print(colorama.Fore.YELLOW + "Waiting 20 seconds before sending another 30 messages...")
                time.sleep(20)
        else:
            # set the proxy to a random one
            
            for i in range(int(amount)):
                # repeat 30 times
                # check if counter is tinier than 30
                

                # wait a random amount from 0.3 to 0.5 seconds
                time.sleep(random.uniform(0.3, 0.5))
                # also get the response from the webhook and request through the proxy
                response = requests.post(webhook, data={"content": message})
                # translate the response to a string
                response = str(response)
                if response == "<Response [204]>":
                    # with colorama
                    counter += 1
                    print(colorama.Fore.GREEN + "Message sent successfully! This is message number " + str(counter) + "!")
                    negateamount = int(negateamount) - 1
                elif response == "<Response [404]>":
                    # print in yellow that the webhook is invalid
                    print(colorama.Fore.YELLOW + "Webhook is invalid!")
                    time.sleep(1)
                    os.chdir("/Users/" + getlocaluser() + "/Library/Application Support/NF2/Data")
                    with open("runnerlocation.txt", "r") as f:
                        runnerlocation = f.read()
                    os.system("python3 " + runnerlocation + "/run.py")
                    exit()
                else:
                    print(colorama.Fore.RED + "Message failed to send!")
                    print(colorama.Fore.RED + "Response: " + response)
                if counter >= 30:
                    print(colorama.Fore.YELLOW + "Waiting 20 seconds before sending another 30 messages...")
                    # wait 20 seconds
                    time.sleep(20)
    else:
        print("Invalid method!")
        time.sleep(1)

else:
    clr()
    # not supported yet
    print("This tool is not supported on your OS yet.")
    exit()
